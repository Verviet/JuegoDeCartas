/**DECLARACION DE ARREGLO Y ASIGNACION DE IMAGEN, VALOR Y CARTAS */


let brillo = [
  { imagen: new Image(), valor: 1 },
  { imagen: new Image(), valor: 2 },
  { imagen: new Image(), valor: 3 },
  { imagen: new Image(), valor: 4 },
  { imagen: new Image(), valor: 5 },
  { imagen: new Image(), valor: 6 },
  { imagen: new Image(), valor: 7 },
  { imagen: new Image(), valor: 8 },
  { imagen: new Image(), valor: 9 },
  { imagen: new Image(), valor: 10 },
  { imagen: new Image(), valor: 10 },
  { imagen: new Image(), valor: 10 },
  { imagen: new Image(), valor: 10 },
  { imagen: new Image(), valor: 11 }
];

brillo[0].imagen.src = '/IMG/BRILLO-A.webp';
brillo[1].imagen.src = '/IMG/BRILLO-2.webp';
brillo[2].imagen.src = '/IMG/BRILLO-3.webp';
brillo[3].imagen.src = '/IMG/BRILLO-4.webp';
brillo[4].imagen.src = '/IMG/BRILLO-5.webp';
brillo[5].imagen.src = '/IMG/BRILLO-6.webp';
brillo[6].imagen.src = '/IMG/BRILLO-7.webp';
brillo[7].imagen.src = '/IMG/BRILLO-8.webp';
brillo[8].imagen.src = '/IMG/BRILLO-9.webp';
brillo[9].imagen.src = '/IMG/BRILLO-10.webp';
brillo[10].imagen.src = '/IMG/BRILLO-J.webp';
brillo[11].imagen.src = '/IMG/BRILLO-Q.webp';
brillo[12].imagen.src = '/IMG/BRILLO-K.webp';
brillo[13].imagen.src = '/IMG/BRILLO-A.webp';



let corazon = [
  { imagen: new Image(), valor: 1 },
  { imagen: new Image(), valor: 2 },
  { imagen: new Image(), valor: 3 },
  { imagen: new Image(), valor: 4 },
  { imagen: new Image(), valor: 5 },
  { imagen: new Image(), valor: 6 },
  { imagen: new Image(), valor: 7 },
  { imagen: new Image(), valor: 8 },
  { imagen: new Image(), valor: 9 },
  { imagen: new Image(), valor: 10 },
  { imagen: new Image(), valor: 10 },
  { imagen: new Image(), valor: 10 },
  { imagen: new Image(), valor: 10 },
  { imagen: new Image(), valor: 11 }
];

corazon[0].imagen.src = '/IMG/CORAZON-A.webp';
corazon[1].imagen.src = '/IMG/CORAZON-2.webp';
corazon[2].imagen.src = '/IMG/CORAZON-3.webp';
corazon[3].imagen.src = '/IMG/CORAZON-4.webp';
corazon[4].imagen.src = '/IMG/CORAZON-5.webp';
corazon[5].imagen.src = '/IMG/CORAZON-6.webp';
corazon[6].imagen.src = '/IMG/CORAZON-7.webp';
corazon[7].imagen.src = '/IMG/CORAZON-8.webp';
corazon[8].imagen.src = '/IMG/CORAZON-9.webp';
corazon[9].imagen.src = '/IMG/CORAZON-10.webp';
corazon[10].imagen.src = '/IMG/CORAZON-J.webp';
corazon[11].imagen.src = '/IMG/CORAZON-Q.webp';
corazon[12].imagen.src = '/IMG/CORAZON-K.webp';
corazon[13].imagen.src = '/IMG/CORAZON-A.webp';


let as = [
  { imagen: new Image(), valor: 1 },
  { imagen: new Image(), valor: 2 },
  { imagen: new Image(), valor: 3 },
  { imagen: new Image(), valor: 4 },
  { imagen: new Image(), valor: 5 },
  { imagen: new Image(), valor: 6 },
  { imagen: new Image(), valor: 7 },
  { imagen: new Image(), valor: 8 },
  { imagen: new Image(), valor: 9 },
  { imagen: new Image(), valor: 10 },
  { imagen: new Image(), valor: 10 },
  { imagen: new Image(), valor: 10 },
  { imagen: new Image(), valor: 10 },
  { imagen: new Image(), valor: 11 }
];

as[0].imagen.src = '/IMG/AS-A.webp';
as[1].imagen.src = '/IMG/AS-2.webp';
as[2].imagen.src = '/IMG/AS-3.webp';
as[3].imagen.src = '/IMG/AS-4.webp';
as[4].imagen.src = '/IMG/AS-5.webp';
as[5].imagen.src = '/IMG/AS-6.webp';
as[6].imagen.src = '/IMG/AS-7.webp';
as[7].imagen.src = '/IMG/AS-8.webp';
as[8].imagen.src = '/IMG/AS-9.webp';
as[9].imagen.src = '/IMG/AS-10.webp';
as[10].imagen.src = '/IMG/AS-J.webp';
as[11].imagen.src = '/IMG/AS-Q.webp';
as[12].imagen.src = '/IMG/AS-K.webp';
as[13].imagen.src = '/IMG/AS-A.webp';

let trebol = [
  { imagen: new Image(), valor: 1 },
  { imagen: new Image(), valor: 2 },
  { imagen: new Image(), valor: 3 },
  { imagen: new Image(), valor: 4 },
  { imagen: new Image(), valor: 5 },
  { imagen: new Image(), valor: 6 },
  { imagen: new Image(), valor: 7 },
  { imagen: new Image(), valor: 8 },
  { imagen: new Image(), valor: 9 },
  { imagen: new Image(), valor: 10 },
  { imagen: new Image(), valor: 10 },
  { imagen: new Image(), valor: 10 },
  { imagen: new Image(), valor: 10 },
  { imagen: new Image(), valor: 11 }
];

trebol[0].imagen.src = '/IMG/TREBOL-A.webp';
trebol[1].imagen.src = '/IMG/TREBOL-2.webp';
trebol[2].imagen.src = '/IMG/TREBOL-3.webp';
trebol[3].imagen.src = '/IMG/TREBOL-4.webp';
trebol[4].imagen.src = '/IMG/TREBOL-5.webp';
trebol[5].imagen.src = '/IMG/TREBOL-6.webp';
trebol[6].imagen.src = '/IMG/TREBOL-7.webp';
trebol[7].imagen.src = '/IMG/TREBOL-8.webp';
trebol[8].imagen.src = '/IMG/TREBOL-9.webp';
trebol[9].imagen.src = '/IMG/TREBOL-10.webp';
trebol[10].imagen.src = '/IMG/TREBOL-J.webp';
trebol[11].imagen.src = '/IMG/TREBOL-Q.webp';
trebol[12].imagen.src = '/IMG/TREBOL-K.webp';
trebol[13].imagen.src = '/IMG/TREBOL-A.webp';

/* CARTAS A ESCOGER */
let card = document.querySelectorAll('.card-choose');

/*BOTONES DE INICIAR, TERMINAR Y REINICIAR */
let btn_iniciar = document.getElementById('btn_iniciar');
let btn_terminar = document.getElementById('btn_terminar');
let btn_reiniciar = document.getElementById('btn_reiniciar');
let btn_A1 = document.getElementById('value-A-1');
let btn_A11 = document.getElementById('value-A-11');

/* VARIABLES DONDE SE MOSTRARAN LAS CARTAS DEL USUARIO*/
let userDivs = [
  document.getElementById('user1'),
  document.getElementById('user2'),
  document.getElementById('user3'),
  document.getElementById('user4'),
  document.getElementById('user5')
];

let userDivs2 = [
  document.getElementById('user1-user'),
  document.getElementById('user2-user'),
  document.getElementById('user3-user'),
  document.getElementById('user4-user'),
  document.getElementById('user5-user')
];

/* VARIABLES DONDE SE MOSTRARAN LAS CARTAS DE LA PC */
let computerDivs = [
  document.getElementById('computer1'),
  document.getElementById('computer2'),
  document.getElementById('computer3'),
  document.getElementById('computer4'),
  document.getElementById('computer5')
];

let computerDivs2 = [
  document.getElementById('computer1-pc'),
  document.getElementById('computer2-pc'),
  document.getElementById('computer3-pc'),
  document.getElementById('computer4-pc'),
  document.getElementById('computer5-pc')
];

let carta_A = document.getElementById('carta-A');

/**VARIABLES DENTRO DE LA EJECUCION DEL PROGRAMA */

/**JUEGO EN CURSO */
let juegoEnCurso = false;

let contador_pc = 0;
let contador_user = 0;
let currentIndex = 0;
let currentIndexPc = 0;

// Cartas elegidas

let contador_trebol = []
let contador_corazon = []
let contador_brillo = []
let contador_as = []

// Clases a ocultar o mostrar
let iniciarjuego = document.querySelector('.iniciar-juego');
let pantalla_fin = document.querySelector('.pantalla_fin');
let choose_A = document.querySelector('.choose-A');
let pantalla_carga = document.querySelector('.pantalla_carga');
let capa = document.querySelector('.capa');
let capa2 = document.querySelector('.capa2');

/** FINALIZAR PARTIDA, VICTORIA, SCORE */

let score_user = document.getElementById('score-user');
let score_user2 = document.getElementById('score-user2');
let score_pc = document.getElementById('score-pc');
let ganador = document.getElementById('ganador');

/************************** CODIGO DE EJECUCION ***********************************************************************/


//REINICIA EL JUEGO

btn_reiniciar.addEventListener('click', function reiniciar_juego() {

  iniciarjuego.style.display = 'flex';
  pantalla_fin.style.display = 'none';
  capa2.style.display = 'none';

  //reiniciar variables
  contador_trebol = []
  contador_corazon = []
  contador_brillo = []
  contador_as = []

  contador_pc = 0;
  contador_user = 0;
  currentIndex = 0;
  currentIndexPc = 0;

  userDivs[0].style.display = 'none';
  userDivs[1].style.display = 'none';
  userDivs[2].style.display = 'none';
  userDivs[3].style.display = 'none';
  userDivs[4].style.display = 'none';

  userDivs2[0].style.display = 'none';
  userDivs2[1].style.display = 'none';
  userDivs2[2].style.display = 'none';
  userDivs2[3].style.display = 'none';
  userDivs2[4].style.display = 'none';

  computerDivs[0].style.display = 'none';
  computerDivs[1].style.display = 'none';
  computerDivs[2].style.display = 'none';
  computerDivs[3].style.display = 'none';
  computerDivs[4].style.display = 'none';

  computerDivs2[0].style.display = 'none';
  computerDivs2[1].style.display = 'none';
  computerDivs2[2].style.display = 'none';
  computerDivs2[3].style.display = 'none';
  computerDivs2[4].style.display = 'none';

})

// Oculta la pantalla de inicio del juego
btn_iniciar.addEventListener('click', function iniciar_juego() {
  iniciarjuego.style.display = 'none';
});




card.forEach(card => {
  card.addEventListener('click', juego);
});


btn_terminar.addEventListener('click', finalizar_juego);

function juego() {

  /**LOS 4 TIPOS DE MAZOS A ELEGIR */
  let aleatorio_4cartas = 0;

  /**LAS 13 CARTAS QUE SE PUEDEN ELEGIR EN UN MAZO */
  let aleatorio_13cartas = 0;

  /**GENERA EL TIPO DE MAZO Y LO GUARDA EN LA VARIABLE ALEATORIO_4CARTAS: UN NUMERO DEL 1 AL 4 */

  aleatorio_4cartas = Math.floor(Math.random() * 4);

  console.log('aleatorio1: ' + aleatorio_4cartas)


  switch (aleatorio_4cartas) {

    case 0:

      do {
        aleatorio_13cartas = Math.floor(Math.random() * 13); // Genera un número aleatorio entre 0 y 12
      } while (contador_trebol.includes(aleatorio_13cartas));

      contador_trebol.push(aleatorio_13cartas);


      if (currentIndex < 5) {
        userDivs[currentIndex].style.display = 'flex';
        userDivs[currentIndex].innerHTML = ''; // Limpia el div antes de añadir la imagen
        userDivs[currentIndex].appendChild(trebol[aleatorio_13cartas].imagen);

        let imagenClonada = trebol[aleatorio_13cartas].imagen.cloneNode(true);
        userDivs2[currentIndex].style.display = 'flex';
        userDivs2[currentIndex].innerHTML = ''; // Limpia el div antes de añadir la imagen
        userDivs2[currentIndex].appendChild(imagenClonada);

        if (aleatorio_13cartas === 0) {

          /**VERIFICAR SI ALGUIEN YA GANÓ O PERDIÓ LA PARTIDA */
           if (contador_user >= 31 || contador_pc >= 31) {
            finalizar_juego();
          } else {
            chooseA(aleatorio_4cartas);
          }

        } else {
          currentIndex++;
          contador_user += trebol[aleatorio_13cartas].valor;

             /**VERIFICAR SI ALGUIEN YA GANÓ O PERDIÓ LA PARTIDA */
             if (contador_user >= 31 || contador_pc >= 31) {
              finalizar_juego();
            } else {
              loader();
            }
        }
      }

      break;

    case 1:

      do {
        aleatorio_13cartas = Math.floor(Math.random() * 13); // Genera un número aleatorio entre 0 y 12
      } while (contador_corazon.includes(aleatorio_13cartas));

      contador_corazon.push(aleatorio_13cartas);


      if (currentIndex < 5) {
        userDivs[currentIndex].style.display = 'flex';
        userDivs[currentIndex].innerHTML = ''; // Limpia el div antes de añadir la imagen
        userDivs[currentIndex].appendChild(corazon[aleatorio_13cartas].imagen);

        let imagenClonada = corazon[aleatorio_13cartas].imagen.cloneNode(true);
        userDivs2[currentIndex].style.display = 'flex';
        userDivs2[currentIndex].innerHTML = ''; // Limpia el div antes de añadir la imagen
        userDivs2[currentIndex].appendChild(imagenClonada);

        if (aleatorio_13cartas === 0) {

          /**VERIFICAR SI ALGUIEN YA GANÓ O PERDIÓ LA PARTIDA */
          if (contador_user >= 31 || contador_pc >= 31) {
            finalizar_juego();
          } else {
            chooseA(aleatorio_4cartas);
          }

        } else {
          currentIndex++;
          contador_user += corazon[aleatorio_13cartas].valor;

             /**VERIFICAR SI ALGUIEN YA GANÓ O PERDIÓ LA PARTIDA */
             if (contador_user >= 31 || contador_pc >= 31) {
              finalizar_juego();
            } else {
              loader();
            }
        }
      }

      break;

    case 2:

      do {
        aleatorio_13cartas = Math.floor(Math.random() * 13); // Genera un número aleatorio entre 0 y 12
      } while (contador_brillo.includes(aleatorio_13cartas));

      contador_brillo.push(aleatorio_13cartas);

      if (currentIndex < 5) {
        userDivs[currentIndex].style.display = 'flex';
        userDivs[currentIndex].innerHTML = ''; // Limpia el div antes de añadir la imagen
        userDivs[currentIndex].appendChild(brillo[aleatorio_13cartas].imagen);

        let imagenClonada = brillo[aleatorio_13cartas].imagen.cloneNode(true);
        userDivs2[currentIndex].style.display = 'flex';
        userDivs2[currentIndex].innerHTML = ''; // Limpia el div antes de añadir la imagen
        userDivs2[currentIndex].appendChild(imagenClonada);

        if (aleatorio_13cartas === 0) {

          /**VERIFICAR SI ALGUIEN YA GANÓ O PERDIÓ LA PARTIDA */
          if (contador_user >= 31 || contador_pc >= 31) {
            finalizar_juego();
          } else {
            chooseA(aleatorio_4cartas);
          }

        } else {
          currentIndex++;
          contador_user += brillo[aleatorio_13cartas].valor;

             /**VERIFICAR SI ALGUIEN YA GANÓ O PERDIÓ LA PARTIDA */
             if (contador_user >= 31 || contador_pc >= 31) {
              finalizar_juego();
            } else {
              loader();
            }
        }
      }

      break;

    case 3:

      do {
        aleatorio_13cartas = Math.floor(Math.random() * 13); // Genera un número aleatorio entre 0 y 12
      } while (contador_as.includes(aleatorio_13cartas));

      contador_as.push(aleatorio_13cartas);


      if (currentIndex < 5) {
        userDivs[currentIndex].style.display = 'flex';
        userDivs[currentIndex].innerHTML = ''; // Limpia el div antes de añadir la imagen
        userDivs[currentIndex].appendChild(as[aleatorio_13cartas].imagen);

        let imagenClonada = as[aleatorio_13cartas].imagen.cloneNode(true);
        userDivs2[currentIndex].style.display = 'flex';
        userDivs2[currentIndex].innerHTML = ''; // Limpia el div antes de añadir la imagen
        userDivs2[currentIndex].appendChild(imagenClonada);


        if (aleatorio_13cartas === 0) {

           /**VERIFICAR SI ALGUIEN YA GANÓ O PERDIÓ LA PARTIDA */
           if (contador_user >= 31 || contador_pc >= 31) {
            finalizar_juego();
          } else {
            chooseA(aleatorio_4cartas);
          }

        }

         else {
          currentIndex++;
          contador_user += as[aleatorio_13cartas].valor;

          /**VERIFICAR SI ALGUIEN YA GANÓ O PERDIÓ LA PARTIDA */
          if (contador_user >= 31 || contador_pc >= 31) {
            finalizar_juego();
          } else {
            loader();
          }

        }
      }

      break;
  }

}


function accion_pc() {

  /**SECCION PC */
  aleatorio_4cartas = Math.floor(Math.random() * 4);

  /**VERIFICADOR DE CARTAS DE PC */
  switch (aleatorio_4cartas) {


    case 0:


      do {
        aleatorio_13cartas = Math.floor(Math.random() * 13); // Genera un número aleatorio entre 0 y 12
      } while (contador_trebol.includes(aleatorio_13cartas));

      contador_trebol.push(aleatorio_13cartas);

      if (currentIndexPc < 5) {

        computerDivs[currentIndexPc].style.display = 'flex';
        computerDivs2[currentIndexPc].style.display = 'flex';
        computerDivs2[currentIndexPc].innerHTML = ''; // Limpia el div antes de añadir la imagen
        computerDivs2[currentIndexPc].appendChild(trebol[aleatorio_13cartas].imagen);

        currentIndexPc++;
        contador_pc += trebol[aleatorio_13cartas].valor;
      }

      break;

    case 1:

      do {
        aleatorio_13cartas = Math.floor(Math.random() * 13); // Genera un número aleatorio entre 0 y 12
      } while (contador_corazon.includes(aleatorio_13cartas));

      contador_corazon.push(aleatorio_13cartas);

      if (currentIndexPc < 5) {

        computerDivs[currentIndexPc].style.display = 'flex';
        computerDivs2[currentIndexPc].style.display = 'flex';
        computerDivs2[currentIndexPc].innerHTML = ''; // Limpia el div antes de añadir la imagen
        computerDivs2[currentIndexPc].appendChild(corazon[aleatorio_13cartas].imagen);

        currentIndexPc++;
        contador_pc += corazon[aleatorio_13cartas].valor;
      }


      break;

    case 2:

      do {
        aleatorio_13cartas = Math.floor(Math.random() * 13); // Genera un número aleatorio entre 0 y 12
      } while (contador_brillo.includes(aleatorio_13cartas));

      contador_brillo.push(aleatorio_13cartas);

      if (currentIndexPc < 5) {

        computerDivs[currentIndexPc].style.display = 'flex';
        computerDivs2[currentIndexPc].style.display = 'flex';
        computerDivs2[currentIndexPc].innerHTML = ''; // Limpia el div antes de añadir la imagen
        computerDivs2[currentIndexPc].appendChild(brillo[aleatorio_13cartas].imagen);

        currentIndexPc++;
        contador_pc += brillo[aleatorio_13cartas].valor;
      }

      break;

    case 3:

      do {
        aleatorio_13cartas = Math.floor(Math.random() * 13); // Genera un número aleatorio entre 0 y 12
      } while (contador_as.includes(aleatorio_13cartas));

      contador_as.push(aleatorio_13cartas);

      if (currentIndexPc < 5) {

        computerDivs[currentIndexPc].style.display = 'flex';
        computerDivs2[currentIndexPc].style.display = 'flex';
        computerDivs2[currentIndexPc].innerHTML = ''; // Limpia el div antes de añadir la imagen
        computerDivs2[currentIndexPc].appendChild(as[aleatorio_13cartas].imagen);

        currentIndexPc++;
        contador_pc += as[aleatorio_13cartas].valor;
      }

      break;
  }


  /**VERIFICAR SI ALGUIEN YA GANÓ O PERDIÓ LA PARTIDA */
  if (contador_user >= 31 || contador_pc >= 31) {
    finalizar_juego();
  }

}


function finalizar_juego() {

  pantalla_fin.style.display = 'flex';
  capa2.style.display = 'flex';

  if ((contador_user <= 31) && (Math.abs(contador_user - 31) < Math.abs(contador_pc - 31))) {

    ganador.textContent = '¡HAS GANADO!';
    score_pc.textContent = 'PC Score: ' + contador_pc;
    score_user.textContent = 'USER Score: ' + contador_user;
    score_user2.textContent = 'USER Score: ' + contador_user;
    ganador.style.color = 'rgb(152, 254, 0)';

  } else if ((contador_pc <= 31) && (Math.abs(contador_user - 31) > Math.abs(contador_pc - 31))) {

    ganador.textContent = '¡HAS PERDIDO!';
    score_pc.textContent = 'PC Score: ' + contador_pc;
    score_user.textContent = 'USER Score: ' + contador_user;
    score_user2.textContent = 'USER Score: ' + contador_user;
    ganador.style.color = 'red';

  } else if ((contador_pc > 31) && (contador_user <= 31)) {

    ganador.textContent = '¡HAS GANADO!';
    score_pc.textContent = 'PC Score: ' + contador_pc;
    score_user.textContent = 'USER Score: ' + contador_user;
    score_user2.textContent = 'USER Score: ' + contador_user;
    ganador.style.color = 'rgb(152, 254, 0)';

  } else if ((contador_pc <= 31) && (contador_user > 31)) {

    ganador.textContent = '¡HAS PERDIDO!';
    score_pc.textContent = 'PC Score: ' + contador_pc;
    score_user.textContent = 'USER Score: ' + contador_user;
    score_user2.textContent = 'USER Score: ' + contador_user;
    ganador.style.color = 'red';

  } else {

    ganador.textContent = '¡EMPATE!';
    score_pc.textContent = 'PC Score: ' + contador_pc;
    score_user.textContent = 'USER Score: ' + contador_user;
    score_user2.textContent = 'USER Score: ' + contador_user;
    ganador.style.color = 'aqua';
  }

}


function chooseA(aleatorio_4cartas) {

  console.log('aleatorio2: ' + aleatorio_4cartas)

  choose_A.style.display = 'flex';
  carta_A.innerHTML = '';


  switch (aleatorio_4cartas) {

    case 0:
      carta_A.innerHTML = '';
      carta_A.appendChild(trebol[13].imagen);

      break;
    case 1:
      carta_A.innerHTML = '';
      carta_A.appendChild(corazon[13].imagen);

      break;
    case 2:
      carta_A.innerHTML = '';
      carta_A.appendChild(brillo[13].imagen);

      break;
    case 3:
      carta_A.innerHTML = '';
      carta_A.appendChild(as[13].imagen);

      break;
  }

  btn_A1.removeEventListener('click', A);
  btn_A11.removeEventListener('click', A11);

  btn_A1.addEventListener('click', A, { once: true });
  btn_A11.addEventListener('click', A11, { once: true })


  function A() {
    currentIndex++;
    choose_A.style.display = 'none';
    contador_user += 1;
    console.log('contador user after: ' + contador_user);
    btn_A11.removeEventListener('click', A11);

    loader();
  }

  function A11() {
    currentIndex++;
    choose_A.style.display = 'none';
    contador_user += 11;
    console.log('contador user after: ' + contador_user);
    btn_A1.removeEventListener('click', A);
    loader();
  }

     /**VERIFICAR SI ALGUIEN YA GANÓ O PERDIÓ LA PARTIDA */
     if (contador_user >= 31 || contador_pc >= 31) {
      finalizar_juego();
    } 
}

function loader() {

  capa.style.display = 'flex';
  pantalla_carga.style.display = 'flex';

  setTimeout(() => {

    pantalla_carga.style.display = 'none';
    capa.style.display = 'none';
    accion_pc();

  }, 3500);

}


